2020-07-02

1. 项目搭建

   >pip install django==2.2.0  -i https://pypi.douban.com/simple
   >
   >pip install djangorestframework  -i https://pypi.douban.com/simple
   >
   >pip install PymySQL  -i https://pypi.douban.com/simple
   >
   >pip install Pillow  -i https://pypi.douban.com/simple
   >
   >pip install django-redis  -i https://pypi.douban.com/simple

2020-07-04

## 4.7 创建数据库

```mysql
create database renran default charset=utf8mb4;
```

为当前项目创建数据库用户[这个用户只能看到这个数据库]

```mysql
# create user 用户名 identified by '登录密码';       # 创建用户

# grant 权限 on 数据库名.表名 to '用户名'@'登录主机';   # 赋予权限给用户
# * 可以表示任意数据库，也可以表示任意表，也可以表示任意登录主机
# all privileges 表示所有权限，也可以设置 单个权限或多个权限
# grant select,insert,update,delete on ....  # 只赋予增删查改的权限
# grant select on ...   # 只赋予查询权限

# flush privileges;                                # 刷新权限

create user renran_user identified by 'renran';
grant all privileges on renran.* to 'renran_user'@'*';
flush privileges;
```



## 4.8 配置数据库连接

打开settings/dev.py文件，并配置

```python
DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.mysql",
        "HOST": "127.0.0.1",
        "PORT": 3306,
        "USER": "renran_user",
        "PASSWORD": "renran",
        "NAME": "renran",
    }
}
```



在项目主模块的 `__init__.py`中导入pymysql

```python
import pymysql

pymysql.install_as_MySQLdb()
```



#### 调整错误

数据库版本检测导致的错误，注释掉

`site-packages/django/db/backends/mysql/base.py`

```
# if version < (1, 3, 13):
    # raise ImproperlyConfigured('mysqlclient 1.3.13 or newer is required; you have %s.' % Database.__version__)
```



因为python3版本的原因，字符串的编码问题

`site-packages/django/db/backends/mysql/operations.py`

```python
把146的代码从下面改动
query = query.decode(errors='replace')
改成：
query = query.encode(errors='replace')
```



在ubuntu中打开项目时候，尽量先打开前端项目，再打开后端项目，不然的话可能打开项目的时候会卡死，若遇到卡死的情况，建议杀死pycharm进程重新运行，要是还不行的话，建议卸载搜狗输入法

